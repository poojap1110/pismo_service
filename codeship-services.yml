build/config:
  image: busybox
  encrypted_env_file: env.encrypted
  volumes:
    - ./:/go/src/bitbucket.org/matchmove/integration-svc-aub

build/test:
  image: golang:latest
  encrypted_env_file: env.encrypted
  volumes_from:
    - build/config

build/app:
  image: golang:latest
  encrypted_env_file: env.encrypted
  volumes_from:
    - build/config

build/docs:
  image: golang:latest
  encrypted_env_file: env.encrypted
  volumes_from:
  - build/config

build/migration:
  image: golang:latest
  encrypted_env_file: env.encrypted
  volumes_from:
  - build/config

docker/build:
  build:
    image: 776499826126.dkr.ecr.ap-southeast-1.amazonaws.com/integration-svc-aub
    dockerfile_path: docker/Dockerfile.build
    encrypted_args_file: KEY.encrypted
  volumes_from:
    - build/config

docker/rabbitmq:
  build:
    image: rabbitmq
    dockerfile_path: docker/Dockerfile
  volumes_from:
  - build/config


dockercfg_generator:
  image: codeship/aws-ecr-dockercfg-generator
  add_docker: true
  encrypted_env_file: env.encrypted

k8s/deploy:
  build:
    image: codeship/kubectl
    dockerfile_path: docker/Dockerfile.push
  encrypted_env_file: env.encrypted
  volumes_from:
    - docker/build