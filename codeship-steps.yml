- name: run/build/config
  service: build/config
  command: sh /go/src/bitbucket.org/matchmove/integration-svc-aub/scripts/build_config.sh 'APP_NAME APP_DOMAIN APP_EXTERNAL_DOMAIN APP_DIR APP_REF_DOCS APP_ENV APP_ENV_FILE APP_ACCESS_LOG APP_VERSION DB_MIGRATION_DIR DB_DRIVER DB_OPEN MEMCACHED_SERVER MEMCACHED_CONFIG OP_PROXY_URL OP_PROXY_VERSION OP_DEFAULT_UNIQUE_ID_TYPE_COUNT OP_REST_DOCUMENTATION_ERROR_URL API_GATEWAY NEW_RELIC_KEY NEW_RELIC_ENABLED NEW_RELIC_THRESHOLD AWS_ACCESS_KEY_ID AWS_SECRET_ACCESS_KEY AWS_DEFAULT_REGION AWS_REGION AWS_DEFAULT_BUCKET ECR_APP_REGISTRY ENV_VAR_HELPER KOPS_STATE_STORE KOPS_CLUSTER_NAME CONTAINER_LIMITS_CPU CONTAINER_LIMITS_MEMORY CONTAINER_REQUESTS_CPU CONTAINER_REQUESTS_MEMORY PODS_MIN_REPLICAS PODS_MAX_REPLICAS PODS_TARGET_CPU_UTILIZATION_PERCENTAGE SERVICE_DISCOVERIES SERVICE_PORT LIC_KEY NETRC_LOGIN NETRC_PASSWORD REPO_OWNER LOG_FOLDER LOG_TYPE_JSON RABBITMQ_SERVER MAX_RETRIES MAX_DELAY_TIME OP_ADDR_PROXY_URL RSA_PRIVATE_KEY_PATH RSA_PUBLIC_KEY_PATH AUB_HOST EXCHANGE_NAME DELAY_EXCHANGE_NAME OP_QUEUE_NAME AUB_QUEUE_NAME PRODUCT_AND_SERVICES MONTHLY_VOLUME_TXN LOG_TIMEZONE DEFAULT_ACCT_METHOD DEFAULT_REMARKS OP_PROXY_HOST JOB_REFETCH_CONFIG_ENABLED JOB_REFETCH_CONFIG_DURATION OAUTH_DB AUB_SVC_KEY AUB_SVC_SECRET SWAGGER_PATH MAX_RETRIES_TOPIC LOCAL_CLUSTER KAFKA_CLUSTER KAFKA_VERSION ASSIGNOR CLUSTER_ENV KAFKA_TOPICS KAFKA_CONSUMER_GROUP_ID AWS_CLUSTER AWS_KAFKA_ACCESS_KEY_ID AWS_KAFKA_SECRET_ACCESS_KEY AWS_KAFKA_DEFAULT_REGION MAX_DELAY'

- name: run/build/app
  service: build/app
  command: sh /go/src/bitbucket.org/matchmove/integration-svc-aub/scripts/build_app.sh

- name: run/build/docs
  tag: ^(master)
  service: build/docs
  command: sh /go/src/bitbucket.org/matchmove/integration-svc-aub/scripts/build_docs.sh

- name: run/push/ecr
  tag: ^(live|master|cicd)
  service: docker/build
  type: push
  image_name: 776499826126.dkr.ecr.ap-southeast-1.amazonaws.com/integration-svc-aub
  image_tag: "{{.CommitID}}"
  args:
    PRIVATE_KEY_MM: "{{.PRIVATE_KEY_MM}}"
    PUBLIC_KEY_AUB: "{{.PUBLIC_KEY_AUB}}"
  registry: https://776499826126.dkr.ecr.ap-southeast-1.amazonaws.com
  dockercfg_service: dockercfg_generator

- name: run/k8s/deploy
  tag: ^(live|master|cicd)
  service: k8s/deploy
  command: sh /go/src/bitbucket.org/matchmove/integration-svc-aub/scripts/k8s_push.sh
